# ============================================================================
# CNPE 图纸处理系统 - 运行期参数规范 v1.0
# ============================================================================
# 说明：
# - 本文件用于描述运行期可配置项（并发/超时/外部程序路径/清理策略等）
# - 与 documents/参数规范.yaml 分离，避免业务字段与运行参数耦合
# ============================================================================

schema_version: "1.0"
last_updated: "2025-01-13"

runtime_options:
  # --------------------------------------------------------------------------
  # 1) 并发与队列
  # --------------------------------------------------------------------------
  concurrency:
    max_workers: { type: int, default: 2, desc: "单机并发工作线程数" }
    max_jobs:    { type: int, default: 4, desc: "同时运行的最大任务数" }
    max_queue:   { type: int, default: 20, desc: "等待队列最大长度" }

  # --------------------------------------------------------------------------
  # 2) 超时与重试
  # --------------------------------------------------------------------------
  timeouts:
    oda_convert_sec:   { type: int, default: 600, desc: "ODA 转换超时（秒）" }
    office_export_sec: { type: int, default: 300, desc: "Office COM 导出超时（秒）" }
    pdf_export_sec:    { type: int, default: 300, desc: "PDF 导出超时（秒）" }
  retries:
    max_retries:      { type: int, default: 2, desc: "失败重试次数" }
    retry_backoff_ms: { type: int, default: 1000, desc: "重试退避间隔（毫秒）" }

  # --------------------------------------------------------------------------
  # 3) 路径与外部程序
  # --------------------------------------------------------------------------
  oda_converter:
    exe_path: { type: str, required: true, desc: "ODA File Converter 可执行文件路径（可使用相对路径）" }
    work_dir: { type: str, required: false, desc: "ODA 临时工作目录（可选）" }
  pdf_engine:
    preferred: { type: enum, default: "office_com", desc: "PDF 引擎优先级：office_com/libreoffice" }
    fallback:  { type: enum, default: "libreoffice", desc: "PDF 引擎兜底" }

  # --------------------------------------------------------------------------
  # 4) 上传限制与资源保护
  # --------------------------------------------------------------------------
  upload_limits:
    max_files:        { type: int, default: 50, desc: "单次上传最大文件数" }
    max_total_mb:     { type: int, default: 2048, desc: "单次上传总大小上限（MB）" }
    allowed_exts:     { type: "list[str]", default: [".dwg"], desc: "允许的上传扩展名" }
    min_free_disk_mb: { type: int, default: 10240, desc: "磁盘最小可用空间阈值（MB）" }

  # --------------------------------------------------------------------------
  # 5) 任务生命周期与清理
  # --------------------------------------------------------------------------
  lifecycle:
    retention_hours:   { type: int, default: 168, desc: "任务产物保留时长（小时）" }
    cleanup_on_cancel: { type: bool, default: true, desc: "取消任务是否清理中间产物" }
    cleanup_cron:      { type: str, default: "0 3 * * *", desc: "定时清理任务（cron）" }

  # --------------------------------------------------------------------------
  # 6) 日志与可观测性
  # --------------------------------------------------------------------------
  logging:
    log_level:   { type: str, default: "INFO", desc: "日志级别" }
    log_to_file: { type: bool, default: true, desc: "是否输出到文件" }

