# 开发计划（可编辑）

## 0. 前提与口径（已确定）
- 先做 **流水线A**（交付包生成），流水线B后置
- 核心思路：主体架构.md + `documents/参数表.md` 确定
- 产物为 `package.zip` + 单独 `IED计划.xlsx`
- 拆分图纸 **PDF+DWG 必须输出**
- 权威规范：`documents/参数规范.yaml`
- 运行期参数：`documents/参数规范_运行期.yaml`

---

## 1. 模块拆分（建议按对话分工）

### 模块1：框架与配置层
**目标**：能加载业务规范与运行期配置，定义任务/存储/manifest 基础结构。  
**输入**：`documents/参数规范.yaml`、`documents/参数规范_运行期.yaml`  
**输出**：Spec Loader、运行期配置加载、存储目录结构、`manifest.json` schema。

### 模块2：DWG→DXF 与图框检测
**目标**：ODA 调用、DXF 解析、外框候选、锚点验证、纸张拟合。  
**输入**：`titleblock_extract` 规范  
**输出**：`FrameMeta.runtime`（paper_variant/sx/sy/roi_profile 等）。

### 模块3：图签字段提取
**目标**：ROI 还原、字段解析、中英文标题分流、比例一致性检查。  
**输入**：`titleblock_extract.field_definitions`  
**输出**：`FrameMeta.titleblock`。

### 模块4：A4 多页成组（001）
**目标**：A4 判定、簇构建、Master/Slave 识别、页码识别、flags。  
**输入**：`documents/A4特殊逻辑.md` + `a4_multipage`  
**输出**：sheet-set 结构 + flags。

### 模块5：裁切/拆分与输出
**目标**：按外框裁切、保持坐标、导出 PDF+DWG（含页边距）。  
**输入**：`pdf_margin_mm` + DWG 必出规则  
**输出**：`output/drawings/` 下 PDF+DWG。

### 模块6：文档生成（封面/目录/设计/IED）
**目标**：模板写入、目录分页计页优化、PDF 导出、IED 单独输出。  
**输入**：`doc_generation` 规范 + `参数表.md`  
**输出**：`output/docs/` + `ied/IED计划.xlsx`。

### 模块7：打包与 API
**目标**：打包 `package.zip`、任务查询/下载、产物清单。  
**输入**：前序模块产物 + `manifest.json`  
**输出**：交付包下载与 IED 单独下载接口。

---

## 2. 推荐实施顺序
**1 → 2 → 3 → 5 → 6 → 7**，  
模块4（A4 多页）可与 2/3 并行推进。

---

## 3. 里程碑（可按对话验收）
- **M1**：配置加载 + 任务/存储/manifest 基础结构可跑
- **M2**：DWG→DXF→图框检测 + 图签提取完成（输出 FrameMeta）
- **M3**：裁切/拆分输出 PDF+DWG 完整
- **M4**：封面/目录/设计文件/IED 生成完成（IED 单独输出）
- **M5**：package.zip 打包与下载闭环

---

## 4. 对话分工建议（开新对话时可直接复制）
- 对话1：框架与配置层（模块1）
- 对话2：DWG→DXF 与图框检测（模块2）
- 对话3：图签字段提取（模块3）
- 对话4：A4 多页成组（模块4）
- 对话5：裁切/拆分与输出（模块5）
- 对话6：文档生成（模块6）
- 对话7：打包与 API（模块7）

---

## 5. 非目标（当前阶段不做）
- 词库检查/替换（流水线B）
- 多机分布式/高可用
- 前端页面与权限系统
